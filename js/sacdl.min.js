var Utils=function(){function n(){var n={},a={name:"languages",children:[]};if(e&&e.items){var r=e.items;r.forEach(function(e,a){"undefined"==typeof n[e.language]&&(n[e.language]=a)});for(var u in n){"null"===u&&(u="others");var t={name:u,children:[]};r.forEach(function(n,e){var a={name:n.full_name,watchers_count:n.watchers_count,forks_count:n.forks_count};"null"===n.language&&(u="null"),(n.language===u||"null"===n.language&&"others"===u)&&t.children.push(a)}),a.children.push(t)}}return a}var e,a;return{getData:function(r){e=r,a=n()},getBarData:function(){var n=a.children,e={labels:[],series:[]},r=[];return n.forEach(function(n){e.labels.push(n.name),r.push(n.children.length)}),e.series.push({label:"Projects count",values:r}),e},getStackData:function(){var n=a.children,e={name:"repos",languages:[]};return n.forEach(function(n){if("null"!==n.name){var a={language:n.name,count:n.children.length};e.languages.push(a)}}),[e]},getTreeData:function(){return a}}}();
var Searcher=function(){function t(){o.q=r.property("value")||"bitcoin";var t=[];for(var n in o)t.push(n+"="+o[n]);return s=e+"?"+t.join("&"),console.log(s),i.text("当前搜索地址: "+s),s}var e,r,n,i,s="",c=[],o={q:"bitcoin",sort:"forks",order:"desc",per_page:100};return{settings:{baseApiUrl:"https://api.github.com/search/repositories"},init:function(){r=d3.select("#search-input"),n=d3.select("#search-btn"),i=d3.select("#search-msg"),e=this.settings.baseApiUrl,n.on("click",function(){t(),c.forEach(function(t){try{t(s)}catch(e){console.log(e)}})})},addListener:function(t){c.push(t)}}}();
var Bar=function(){function t(t){for(var e=0;e<t.labels.length;e++)for(var r=0;r<t.series.length;r++)u.push(t.series[r].values[e])}function e(){u=[],a=Utils.getBarData(),i=l*a.series.length,t(a);var e=d3.scale.category20(),r=l*u.length+c*a.labels.length,g=d3.scale.linear().domain([0,d3.max(u)]).range([0,s]),h=d3.scale.linear().range([r+c,0]);n=d3.svg.axis().scale(h).tickFormat("").tickSize(0).orient("left");var f=chart.attr("width",o+s+d).attr("height",r),p=f.selectAll("g").data(u,function(t,e){return[t,e]}),x=p.enter().append("g").attr("transform",function(t,e){return"translate("+o+","+(e*l+c*(.5+Math.floor(e/a.series.length)))+")"});x.append("rect").attr("fill",function(t,r){return e(r%a.series.length)}).attr("class","bar").attr("width",g).attr("height",l-1),x.append("text").attr("x",function(t){return g(t)-3}).attr("y",l/2).attr("fill","red").attr("dy",".35em").text(function(t){return t}),x.append("text").attr("class","label").attr("x",function(t){return-10}).attr("y",i/2).attr("dy",".35em").text(function(t,e){return e%a.series.length===0?a.labels[Math.floor(e/a.series.length)]:""}),p.exit().transition().style({opacity:0}).remove(),f.append("g").attr("class","y axis").attr("transform","translate("+o+", "+-c/2+")").call(n);var b=18,v=4,y=f.selectAll(".legend").data(a.series),m=y.enter().append("g").attr("transform",function(t,e){var r=b+v,a=-c/2,n=o+s+40-b,l=e*r-a;return"translate("+n+","+l+")"});m.append("rect").attr("width",b).attr("height",b).style("fill",function(t,r){return e(r)}).style("stroke",function(t,r){return e(r)}),m.append("text").attr("class","legend").attr("x",b+v).attr("y",b-v).text(function(t){return t.label}),y.exit().remove()}var r,a,n,s=300,l=20,i=0,c=10,o=150,d=150,u=[];return{settings:{title:"barTitle",desc:"barDesc",barId:"#barId"},init:function(){r=this.settings.barId,d3.select("#barTitle").text(this.settings.title),d3.select("#barDesc").text(this.settings.desc),chart=d3.select(r).append("svg").attr("class","chart")},show:function(){e()}}}();
var Treemap=function(){function t(t){p=f=Utils.getTreeData(t);var a=i.nodes(f).filter(function(t){return!t.children}),s=c.selectAll("g").data(a,function(t){return t.watchers_count}).enter().append("g").attr("class","cell").attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).on("click",function(t){return r(p==t.parent?f:t.parent)});s.append("rect").attr("width",function(t){return t.dx-1}).attr("height",function(t){return t.dy-1}).style("fill",function(t){return d(t.parent.name)}),s.append("text").attr("x",function(t){return 2*t.dx/3+20}).attr("y",function(t){return t.dy/2}).attr("dy",".35em").attr("text-anchor","middle").text(function(t){return t.name}).style("opacity",function(t){return t.w=this.getComputedTextLength(),1}),c.selectAll("g").data(a).exit().transition().style({opacity:0}).remove(),d3.select(window).on("click",function(){r(f)}),d3.select("#treemapSelect").on("change",function(){i.value("watchers"==this.value?e:n).nodes(f),r(p)})}function e(t){return t.watchers_count}function n(t){return t.forks_count}function r(t){var e=s/t.dx,n=o/t.dy;u.domain([t.x,t.x+t.dx]),l.domain([t.y,t.y+t.dy]);var r=c.selectAll("g.cell").transition().duration(d3.event.altKey?7500:750).attr("transform",function(t){return"translate("+u(t.x)+","+l(t.y)+")"});r.select("rect").attr("width",function(t){return e*t.dx-1}).attr("height",function(t){return n*t.dy-1}),r.select("text").attr("x",function(t){return 2*e*t.dx/3+20}).attr("y",function(t){return n*t.dy/2}).style("opacity",function(t){return 1}),p=t,d3.event.stopPropagation()}var a,i,c,s=970,o=500,u=d3.scale.linear().range([0,s]),l=d3.scale.linear().range([0,o]),d=d3.scale.category20c(),f=[],p=[];return{settings:{title:"treemapTitle",desc:"treemapDesc",treemapId:"#treemapId"},init:function(){var t=this.settings.treemapId;d3.select("#treemapTitle").text(this.settings.title),d3.select("#treemapDesc").text(this.settings.desc),a=d3.select(t).append("div").attr("class","chart").style("width",s+"px").style("height",o+"px"),c=a.append("svg").attr("width",s).attr("height",o).append("g").attr("transform","translate(.5,.5)"),i=d3.layout.treemap().size([s,o]).value(function(t){return t.watchers_count})},show:function(e){t(e)}}}();
!function(){function e(e){var a=setTimeout(function(){t.style.display="block"},300);e=e||"https://api.github.com/search/repositories?q=bitcoin&sort=forks&order=desc&per_page=100",d3.json(e,function(e,i){e&&(clearTimeout(a),t.style.display="none",alert("加载数据失败，请检查您的网络设置。")),Utils.getData(i),Bar.show(),Treemap.show(),clearTimeout(a),t.style.display="none"})}var t=document.getElementById("modal");Searcher.init(),Bar.settings={title:"Top100 BarChart",desc:"This is a good example.",barId:"#barId"},Bar.init(),Treemap.settings={title:"Top100 treemap",desc:"You can click the block to zoom it.",treemapId:"#sacdlTreemap"},Treemap.init(),Searcher.addListener(function(t){e(t)}),e()}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWxzLmpzIiwic2VhcmNoZXIuanMiLCJiYXIuanMiLCJ0cmVlbWFwLmpzIiwiYXBwLmpzIl0sIm5hbWVzIjpbIlV0aWxzIiwiZGF0YVRvSnNvbiIsImxhbmd1YWdlcyIsInJlc3VsdCIsIm5hbWUiLCJjaGlsZHJlbiIsImRhdGFTZXQiLCJpdGVtcyIsImZvckVhY2giLCJpdGVtIiwiaW5kZXgiLCJsYW5ndWFnZSIsInJvb3QiLCJjaGlsZCIsImZ1bGxfbmFtZSIsIndhdGNoZXJzX2NvdW50IiwiZm9ya3NfY291bnQiLCJwdXNoIiwidHJlZURhdGEiLCJnZXREYXRhIiwiZGF0YSIsImdldEJhckRhdGEiLCJsYWJlbHMiLCJzZXJpZXMiLCJ2YWx1ZXMiLCJsZW5ndGgiLCJsYWJlbCIsImdldFN0YWNrRGF0YSIsImNvdW50IiwiZ2V0VHJlZURhdGEiLCJTZWFyY2hlciIsInBhcnNlUXVlcnkiLCJxdWVyeSIsInEiLCJpbnB1dFR4dCIsInByb3BlcnR5IiwiYXJyIiwia2V5IiwidXJsIiwiYmFzZUFwaVVybCIsImpvaW4iLCJjb25zb2xlIiwibG9nIiwic2VhcmNoTXNnIiwidGV4dCIsInNlYXJjaEJ0biIsImxpc3RlbmVycyIsInNvcnQiLCJvcmRlciIsInBlcl9wYWdlIiwic2V0dGluZ3MiLCJpbml0IiwiZDMiLCJzZWxlY3QiLCJ0aGlzIiwib24iLCJsaXN0ZW5lciIsImVycm9yIiwiYWRkTGlzdGVuZXIiLCJCYXIiLCJ6aXBwaW5nRGF0YSIsImkiLCJqIiwiemlwcGVkRGF0YSIsInNob3dCYXIiLCJncm91cEhlaWdodCIsImJhckhlaWdodCIsImNvbG9yIiwic2NhbGUiLCJjYXRlZ29yeTIwIiwiY2hhcnRIZWlnaHQiLCJnYXBCZXR3ZWVuR3JvdXBzIiwieCIsImxpbmVhciIsImRvbWFpbiIsIm1heCIsInJhbmdlIiwiY2hhcnRXaWR0aCIsInkiLCJ5QXhpcyIsInN2ZyIsImF4aXMiLCJ0aWNrRm9ybWF0IiwidGlja1NpemUiLCJvcmllbnQiLCJjaGFydCIsImF0dHIiLCJzcGFjZUZvckxhYmVscyIsInNwYWNlRm9yTGVnZW5kIiwiYmFyTm9kZXMiLCJzZWxlY3RBbGwiLCJkIiwiYmFyIiwiZW50ZXIiLCJhcHBlbmQiLCJNYXRoIiwiZmxvb3IiLCJleGl0IiwidHJhbnNpdGlvbiIsInN0eWxlIiwib3BhY2l0eSIsInJlbW92ZSIsImNhbGwiLCJsZWdlbmRSZWN0U2l6ZSIsImxlZ2VuZFNwYWNpbmciLCJsZWdlbmREYXRhIiwibGVnZW5kIiwiaGVpZ2h0Iiwib2Zmc2V0IiwiaG9yeiIsInZlcnQiLCJiYXJJZCIsInRpdGxlIiwiZGVzYyIsInNob3ciLCJUcmVlbWFwIiwic2hvd0NoYXJ0Iiwibm9kZSIsIm5vZGVzIiwidHJlZW1hcCIsImZpbHRlciIsImNlbGwiLCJ6b29tIiwicGFyZW50IiwiZHgiLCJkeSIsInciLCJnZXRDb21wdXRlZFRleHRMZW5ndGgiLCJ3aW5kb3ciLCJ2YWx1ZSIsIndhdGNoZXJzQ291bnQiLCJmb3Jrc0NvdW50Iiwia3giLCJreSIsImgiLCJ0IiwiZHVyYXRpb24iLCJldmVudCIsImFsdEtleSIsInN0b3BQcm9wYWdhdGlvbiIsImNhdGVnb3J5MjBjIiwidHJlZW1hcElkIiwibGF5b3V0Iiwic2l6ZSIsImxvYWRlciIsInNldFRpbWVvdXQiLCJsb2FkaW5nIiwiZGlzcGxheSIsImpzb24iLCJlcnIiLCJjbGVhclRpbWVvdXQiLCJhbGVydCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiXSwibWFwcGluZ3MiOiJBQUFBLEdBQUlBLE9BQVMsV0E2RlQsUUFBU0MsS0FDTCxHQUFJQyxNQUVBQyxHQUNBQyxLQUFRLFlBQ1JDLFlBR0osSUFBSUMsR0FBV0EsRUFBUUMsTUFBTyxDQUMxQixHQUFJQSxHQUFRRCxFQUFRQyxLQUVwQkEsR0FBTUMsUUFBUSxTQUFTQyxFQUFNQyxHQUNlLG1CQUE3QlIsR0FBVU8sRUFBS0UsWUFDdEJULEVBQVVPLEVBQUtFLFVBQVlELElBSW5DLEtBQUssR0FBSUMsS0FBWVQsR0FBVyxDQUNYLFNBQWJT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QU0sU0FBUzlGLEdBQ1hnRyxFQUFVaEc7Q0MvQ3RCLFdBNEJJLFFBQVM4RixHQUFLNUUsR0FDVixHQUFJMEcsR0FBU0MsV0FBVyxXQUNwQkMsRUFBUS9DLE1BQU1nRCxRQUFVLFNBQ3pCLElBRUg3RyxHQUFNQSxHQUFPLDBGQUViYyxHQUFHZ0csS0FBSzlHLEVBQUssU0FBUytHLEVBQUtqSSxHQUNuQmlJLElBQ0FDLGFBQWFOLEdBQ2JFLEVBQVEvQyxNQUFNZ0QsUUFBVSxPQUN4QkksTUFBTSxzQkFHVnZKLE1BQU1tQixRQUFRQyxHQUVkdUMsSUFBSXVELE9BQ0pDLFFBQVFELE9BRVJvQyxhQUFhTixHQUNiRSxFQUFRL0MsTUFBTWdELFFBQVUsU0EvQ2hDLEdBQUlELEdBQVVNLFNBQVNDLGVBQWUsUUFLdEMzSCxVQUFTcUIsT0FLVFEsSUFBSVQsVUFDQThELE1BQU8sa0JBQ1BDLEtBQU0sMEJBQ05GLE1BQU8sVUFFWHBELElBQUlSLE9BS0pnRSxRQUFRakUsVUFDSjhELE1BQU8saUJBQ1BDLEtBQU0sc0NBQ040QixVQUFXLGlCQUVmMUIsUUFBUWhFLE9BMEJSckIsU0FBUzRCLFlBQVksU0FBU3BCLEdBQzFCNEUsRUFBSzVFLEtBR1Q0RSIsImZpbGUiOiJzYWNkbC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgVXRpbHMgPSAoZnVuY3Rpb24oKSB7XG4gICAgdmFyIGRhdGFTZXQsIHRyZWVEYXRhO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgZ2V0RGF0YTogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgZGF0YVNldCA9IGRhdGE7XG4gICAgICAgICAgICB0cmVlRGF0YSA9IGRhdGFUb0pzb24oKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgIERhdGEgZm9ybWF0OlxuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbHM6IFtcbiAgICAgICAgICAgICAgICAnYy9jKysnLCAncHl0aG9uJywgJ2phdmFzY3JpcHQnLFxuICAgICAgICAgICAgICAgICdqYXZhJywgJ3J1YnknLCAnaHRtbCdcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBzZXJpZXM6IFt7XG4gICAgICAgICAgICAgICAgbGFiZWw6ICdQcm9qZWN0cyBjb3VudCcsXG4gICAgICAgICAgICAgICAgdmFsdWVzOiBbNCwgOCwgMTUsIDE2LCAyMywgNDJdIC8vY291bnRzXG4gICAgICAgICAgICB9XVxuICAgICAgICB9XG4gICAgICAgICovXG4gICAgICAgIGdldEJhckRhdGE6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGl0ZW1zID0gdHJlZURhdGEuY2hpbGRyZW47XG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgICAgICBsYWJlbHM6IFtdLFxuICAgICAgICAgICAgICAgICAgICBzZXJpZXM6IFtdXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB2YWx1ZXMgPSBbXTtcblxuICAgICAgICAgICAgaXRlbXMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmxhYmVscy5wdXNoKGl0ZW0ubmFtZSk7XG4gICAgICAgICAgICAgICAgdmFsdWVzLnB1c2goaXRlbS5jaGlsZHJlbi5sZW5ndGgpO1xuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgcmVzdWx0LnNlcmllcy5wdXNoKHtcbiAgICAgICAgICAgICAgICBsYWJlbDogJ1Byb2plY3RzIGNvdW50JyxcbiAgICAgICAgICAgICAgICB2YWx1ZXM6IHZhbHVlc1xuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgW1xuICAgICAgICAgICAgICAgICB7IG5hbWU6IFwicmVwb3NcIiAsIFxuICAgICAgICAgICAgICAgICAgIGxhbmd1YWdlczogWyAgeyBsYW5ndWFnZTogJ2pzJywgY291bnQ6IDMwMDAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBsYW5ndWFnZTogJ3J1YnknLCBjb3VudDogMTMwMCB9XVxuICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgIGdldFN0YWNrRGF0YTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgaXRlbXMgPSB0cmVlRGF0YS5jaGlsZHJlbjtcblxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHtcbiAgICAgICAgICAgICAgICBuYW1lOiBcInJlcG9zXCIsXG4gICAgICAgICAgICAgICAgbGFuZ3VhZ2VzOiBbXVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLzEuIOehruWumuWIneWni+aVsOaNrlxuICAgICAgICAgICAgaXRlbXMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0ubmFtZSA9PT0gXCJudWxsXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB2YXIgY2hpbGQgPSB7XG4gICAgICAgICAgICAgICAgICAgIGxhbmd1YWdlOiBpdGVtLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGNvdW50OiBpdGVtLmNoaWxkcmVuLmxlbmd0aFxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICByZXN1bHQubGFuZ3VhZ2VzLnB1c2goY2hpbGQpO1xuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgcmV0dXJuIFtyZXN1bHRdO1xuICAgICAgICB9LFxuICAgICAgICAvKiogRGF0YSBmb3JtYXQ6XG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcImxhbmd1YWdlc1wiLFxuICAgICAgICAgICAgICAgICAgICBcImNoaWxkcmVuXCI6IFt7XG4gICAgICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJqYXZhc2NyaXB0XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImNoaWxkcmVuXCI6IFt7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiaW1mbHkvbXlJREVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIndhdGNoZXJzX2NvdW50XCI6IDEwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImZvcmtzX2NvdW50XCI6IDUwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic2l6ZVwiOiAyMFxuICAgICAgICAgICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0VHJlZURhdGE6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRyZWVEYXRhO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAvL3Byb3ZpdGUgbWV0aG9kc1xuICAgIGZ1bmN0aW9uIGRhdGFUb0pzb24oKSB7XG4gICAgICAgIHZhciBsYW5ndWFnZXMgPSB7fTtcblxuICAgICAgICB2YXIgcmVzdWx0ID0ge1xuICAgICAgICAgICAgXCJuYW1lXCI6IFwibGFuZ3VhZ2VzXCIsXG4gICAgICAgICAgICBcImNoaWxkcmVuXCI6IFtdXG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGF0YVNldCAmJiBkYXRhU2V0Lml0ZW1zKSB7XG4gICAgICAgICAgICB2YXIgaXRlbXMgPSBkYXRhU2V0Lml0ZW1zO1xuXG4gICAgICAgICAgICBpdGVtcy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0sIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBsYW5ndWFnZXNbaXRlbS5sYW5ndWFnZV0gPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2VzW2l0ZW0ubGFuZ3VhZ2VdID0gaW5kZXg7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIGZvciAodmFyIGxhbmd1YWdlIGluIGxhbmd1YWdlcykge1xuICAgICAgICAgICAgICAgIGlmIChsYW5ndWFnZSA9PT0gXCJudWxsXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2UgPSBcIm90aGVyc1wiO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB2YXIgcm9vdCA9IHtcbiAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IGxhbmd1YWdlLFxuICAgICAgICAgICAgICAgICAgICBcImNoaWxkcmVuXCI6IFtdXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIGl0ZW1zLmZvckVhY2goZnVuY3Rpb24oaXRlbSwgaW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNoaWxkID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IGl0ZW0uZnVsbF9uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ3YXRjaGVyc19jb3VudFwiOiBpdGVtLndhdGNoZXJzX2NvdW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJmb3Jrc19jb3VudFwiOiBpdGVtLmZvcmtzX2NvdW50XG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0ubGFuZ3VhZ2UgPT09IFwibnVsbFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYW5ndWFnZSA9IFwibnVsbFwiO1xuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmxhbmd1YWdlID09PSBsYW5ndWFnZSB8fCAoaXRlbS5sYW5ndWFnZSA9PT0gXCJudWxsXCIgJiYgbGFuZ3VhZ2UgPT09IFwib3RoZXJzXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByb290LmNoaWxkcmVuLnB1c2goY2hpbGQpO1xuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgIHJlc3VsdC5jaGlsZHJlbi5wdXNoKHJvb3QpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gZGVsZXRlIGRhdGFTZXQuaXRlbXM7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuIFxuICAgIGZ1bmN0aW9uIG1lcmdlVG8odG8sIGZyb20pIHtcbiAgICAgICAgZm9yICh2YXIga2V5IGluIGZyb20pIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdG9ba2V5XSA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgICAgIHRvW2tleV0gPSBmcm9tW2tleV1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxufSgpKVxuIiwidmFyIFNlYXJjaGVyID0gKGZ1bmN0aW9uKCkge1xuICAgIHZhciB1cmwgPSAnJyxcbiAgICAgICAgYmFzZUFwaVVybCxcbiAgICAgICAgaW5wdXRUeHQsXG4gICAgICAgIHNlYXJjaEJ0bixcbiAgICAgICAgc2VhcmNoTXNnLFxuICAgICAgICBsaXN0ZW5lcnMgPSBbXSxcbiAgICAgICAgcXVlcnkgPSB7XG4gICAgICAgICAgICBxOiAnYml0Y29pbicsXG4gICAgICAgICAgICBzb3J0OiBcImZvcmtzXCIsXG4gICAgICAgICAgICBvcmRlcjogXCJkZXNjXCIsXG4gICAgICAgICAgICBwZXJfcGFnZTogMTAwXG4gICAgICAgIH07XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBzZXR0aW5nczoge1xuICAgICAgICAgICAgYmFzZUFwaVVybDogJ2h0dHBzOi8vYXBpLmdpdGh1Yi5jb20vc2VhcmNoL3JlcG9zaXRvcmllcydcbiAgICAgICAgfSxcblxuICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlucHV0VHh0ID0gZDMuc2VsZWN0KCcjc2VhcmNoLWlucHV0Jyk7XG4gICAgICAgICAgICBzZWFyY2hCdG4gPSBkMy5zZWxlY3QoJyNzZWFyY2gtYnRuJyk7XG4gICAgICAgICAgICBzZWFyY2hNc2cgPSBkMy5zZWxlY3QoJyNzZWFyY2gtbXNnJylcblxuICAgICAgICAgICAgYmFzZUFwaVVybCA9IHRoaXMuc2V0dGluZ3MuYmFzZUFwaVVybDtcblxuICAgICAgICAgICAgc2VhcmNoQnRuLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHBhcnNlUXVlcnkoKTtcbiAgICAgICAgICAgICAgICBsaXN0ZW5lcnMuZm9yRWFjaChmdW5jdGlvbihsaXN0ZW5lcikge1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGlzdGVuZXIodXJsKTtcbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KVxuICAgICAgICB9LFxuXG4gICAgICAgIGFkZExpc3RlbmVyOiBmdW5jdGlvbihsaXN0ZW5lcikge1xuICAgICAgICAgICAgbGlzdGVuZXJzLnB1c2gobGlzdGVuZXIpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIHBhcnNlUXVlcnkoKSB7XG4gICAgICAgIHF1ZXJ5LnEgPSBpbnB1dFR4dC5wcm9wZXJ0eSgndmFsdWUnKSB8fCAnYml0Y29pbic7XG4gICAgICAgIHZhciBhcnIgPSBbXTtcblxuICAgICAgICBmb3IgKHZhciBrZXkgaW4gcXVlcnkpIHtcbiAgICAgICAgICAgIGFyci5wdXNoKGtleSArICc9JyArIHF1ZXJ5W2tleV0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHVybCA9IGJhc2VBcGlVcmwgKyAnPycgKyBhcnIuam9pbignJicpO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKHVybCk7XG4gICAgICAgIHNlYXJjaE1zZy50ZXh0KCflvZPliY3mkJzntKLlnLDlnYA6ICcgKyB1cmwpO1xuICAgICAgICByZXR1cm4gdXJsO1xuICAgIH1cbn0oKSlcbiIsInZhciBCYXIgPSAoZnVuY3Rpb24oKSB7XG4gICAgdmFyIGNoYXJ0V2lkdGggPSAzMDAsXG4gICAgICAgIGJhckhlaWdodCA9IDIwLFxuICAgICAgICBncm91cEhlaWdodCA9IDAsXG4gICAgICAgIGdhcEJldHdlZW5Hcm91cHMgPSAxMCxcbiAgICAgICAgc3BhY2VGb3JMYWJlbHMgPSAxNTAsXG4gICAgICAgIHNwYWNlRm9yTGVnZW5kID0gMTUwLFxuICAgICAgICBiYXJJZCxcbiAgICAgICAgc3ZnLFxuICAgICAgICBkYXRhLFxuICAgICAgICB5QXhpcztcblxuICAgIC8vIFppcCB0aGUgc2VyaWVzIGRhdGEgdG9nZXRoZXIgKGZpcnN0IHZhbHVlcywgc2Vjb25kIHZhbHVlcywgZXRjLilcbiAgICB2YXIgemlwcGVkRGF0YSA9IFtdO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgc2V0dGluZ3M6IHtcbiAgICAgICAgICAgIHRpdGxlOiBcImJhclRpdGxlXCIsXG4gICAgICAgICAgICBkZXNjOiBcImJhckRlc2NcIixcbiAgICAgICAgICAgIGJhcklkOiBcIiNiYXJJZFwiXG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBiYXJJZCA9IHRoaXMuc2V0dGluZ3MuYmFySWQ7XG5cbiAgICAgICAgICAgIGQzLnNlbGVjdChcIiNiYXJUaXRsZVwiKS50ZXh0KHRoaXMuc2V0dGluZ3MudGl0bGUpO1xuICAgICAgICAgICAgZDMuc2VsZWN0KFwiI2JhckRlc2NcIikudGV4dCh0aGlzLnNldHRpbmdzLmRlc2MpO1xuXG4gICAgICAgICAgICBjaGFydCA9IGQzLnNlbGVjdChiYXJJZCkuYXBwZW5kKFwic3ZnXCIpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImNoYXJ0XCIpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNob3c6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2hvd0JhcigpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gemlwcGluZ0RhdGEoZGF0YSkge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRhdGEubGFiZWxzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGRhdGEuc2VyaWVzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgemlwcGVkRGF0YS5wdXNoKGRhdGEuc2VyaWVzW2pdLnZhbHVlc1tpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzaG93QmFyKCkge1xuICAgICAgICAvL0NsZWFuXG4gICAgICAgIHppcHBlZERhdGEgPSBbXTtcblxuICAgICAgICBkYXRhID0gVXRpbHMuZ2V0QmFyRGF0YSgpO1xuICAgICAgICBncm91cEhlaWdodCA9IGJhckhlaWdodCAqIGRhdGEuc2VyaWVzLmxlbmd0aDtcblxuICAgICAgICB6aXBwaW5nRGF0YShkYXRhKTtcblxuICAgICAgICAvLyBDb2xvciBzY2FsZVxuICAgICAgICB2YXIgY29sb3IgPSBkMy5zY2FsZS5jYXRlZ29yeTIwKCk7XG4gICAgICAgIHZhciBjaGFydEhlaWdodCA9IGJhckhlaWdodCAqIHppcHBlZERhdGEubGVuZ3RoICsgZ2FwQmV0d2Vlbkdyb3VwcyAqIGRhdGEubGFiZWxzLmxlbmd0aDtcblxuICAgICAgICB2YXIgeCA9IGQzLnNjYWxlLmxpbmVhcigpXG4gICAgICAgICAgICAuZG9tYWluKFswLCBkMy5tYXgoemlwcGVkRGF0YSldKVxuICAgICAgICAgICAgLnJhbmdlKFswLCBjaGFydFdpZHRoXSk7XG5cbiAgICAgICAgdmFyIHkgPSBkMy5zY2FsZS5saW5lYXIoKVxuICAgICAgICAgICAgLnJhbmdlKFtjaGFydEhlaWdodCArIGdhcEJldHdlZW5Hcm91cHMsIDBdKTtcblxuICAgICAgICB5QXhpcyA9IGQzLnN2Zy5heGlzKClcbiAgICAgICAgICAgIC5zY2FsZSh5KVxuICAgICAgICAgICAgLnRpY2tGb3JtYXQoJycpXG4gICAgICAgICAgICAudGlja1NpemUoMClcbiAgICAgICAgICAgIC5vcmllbnQoXCJsZWZ0XCIpO1xuXG4gICAgICAgIHZhciBzdmcgPSBjaGFydFxuICAgICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCBzcGFjZUZvckxhYmVscyArIGNoYXJ0V2lkdGggKyBzcGFjZUZvckxlZ2VuZClcbiAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGNoYXJ0SGVpZ2h0KTtcblxuICAgICAgICAvLyBHZXQgdGhlIG5vZGVzXG4gICAgICAgIHZhciBiYXJOb2RlcyA9IHN2Zy5zZWxlY3RBbGwoXCJnXCIpLmRhdGEoemlwcGVkRGF0YSwgZnVuY3Rpb24gKGQsIGkpIHtcbiAgICAgICAgICAgIHJldHVybiBbZCwgaV07XG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gQ3JlYXRlIGJhcnNcbiAgICAgICAgdmFyIGJhciA9IGJhck5vZGVzXG4gICAgICAgICAgICAuZW50ZXIoKVxuICAgICAgICAgICAgLmFwcGVuZChcImdcIilcbiAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGZ1bmN0aW9uKGQsIGkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJ0cmFuc2xhdGUoXCIgKyBzcGFjZUZvckxhYmVscyArIFwiLFwiICsgKGkgKiBiYXJIZWlnaHQgKyBnYXBCZXR3ZWVuR3JvdXBzICogKDAuNSArIE1hdGguZmxvb3IoaSAvIGRhdGEuc2VyaWVzLmxlbmd0aCkpKSArIFwiKVwiO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQ3JlYXRlIHJlY3RhbmdsZXMgb2YgdGhlIGNvcnJlY3Qgd2lkdGhcbiAgICAgICAgYmFyLmFwcGVuZChcInJlY3RcIilcbiAgICAgICAgICAgIC5hdHRyKFwiZmlsbFwiLCBmdW5jdGlvbihkLCBpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbG9yKGkgJSBkYXRhLnNlcmllcy5sZW5ndGgpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJiYXJcIilcbiAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgeClcbiAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGJhckhlaWdodCAtIDEpO1xuXG4gICAgICAgIC8vIEFkZCB0ZXh0IGxhYmVsIGluIGJhclxuICAgICAgICBiYXIuYXBwZW5kKFwidGV4dFwiKVxuICAgICAgICAgICAgLmF0dHIoXCJ4XCIsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geChkKSAtIDM7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIGJhckhlaWdodCAvIDIpXG4gICAgICAgICAgICAuYXR0cihcImZpbGxcIiwgXCJyZWRcIilcbiAgICAgICAgICAgIC5hdHRyKFwiZHlcIiwgXCIuMzVlbVwiKVxuICAgICAgICAgICAgLnRleHQoZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gRHJhdyBsYWJlbHNcbiAgICAgICAgYmFyLmFwcGVuZChcInRleHRcIilcbiAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJsYWJlbFwiKVxuICAgICAgICAgICAgLmF0dHIoXCJ4XCIsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gLTEwO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5hdHRyKFwieVwiLCBncm91cEhlaWdodCAvIDIpXG4gICAgICAgICAgICAuYXR0cihcImR5XCIsIFwiLjM1ZW1cIilcbiAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uKGQsIGkpIHtcbiAgICAgICAgICAgICAgICBpZiAoaSAlIGRhdGEuc2VyaWVzLmxlbmd0aCA9PT0gMClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEubGFiZWxzW01hdGguZmxvb3IoaSAvIGRhdGEuc2VyaWVzLmxlbmd0aCldO1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiXCJcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIC8vIERlbGV0ZSB0aGUgZXh0cmEgbm9kZXNcbiAgICAgICAgYmFyTm9kZXMuZXhpdCgpXG4gICAgICAgICAgICAudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAuc3R5bGUoe1xuICAgICAgICAgICAgICAgIG9wYWNpdHk6IDBcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAucmVtb3ZlKCk7XG5cbiAgICAgICAgc3ZnLmFwcGVuZChcImdcIilcbiAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ5IGF4aXNcIilcbiAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKFwiICsgc3BhY2VGb3JMYWJlbHMgKyBcIiwgXCIgKyAtZ2FwQmV0d2Vlbkdyb3VwcyAvIDIgKyBcIilcIilcbiAgICAgICAgICAgIC5jYWxsKHlBeGlzKTtcblxuICAgICAgICAvLyBEcmF3IGxlZ2VuZFxuICAgICAgICB2YXIgbGVnZW5kUmVjdFNpemUgPSAxOCxcbiAgICAgICAgICAgIGxlZ2VuZFNwYWNpbmcgPSA0O1xuXG4gICAgICAgIHZhciBsZWdlbmREYXRhID0gc3ZnLnNlbGVjdEFsbCgnLmxlZ2VuZCcpXG4gICAgICAgICAgICAuZGF0YShkYXRhLnNlcmllcyk7XG5cbiAgICAgICAgdmFyIGxlZ2VuZCA9IGxlZ2VuZERhdGFcbiAgICAgICAgICAgIC5lbnRlcigpXG4gICAgICAgICAgICAuYXBwZW5kKCdnJylcbiAgICAgICAgICAgIC5hdHRyKCd0cmFuc2Zvcm0nLCBmdW5jdGlvbihkLCBpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGhlaWdodCA9IGxlZ2VuZFJlY3RTaXplICsgbGVnZW5kU3BhY2luZztcbiAgICAgICAgICAgICAgICB2YXIgb2Zmc2V0ID0gLWdhcEJldHdlZW5Hcm91cHMgLyAyO1xuICAgICAgICAgICAgICAgIHZhciBob3J6ID0gc3BhY2VGb3JMYWJlbHMgKyBjaGFydFdpZHRoICsgNDAgLSBsZWdlbmRSZWN0U2l6ZTtcbiAgICAgICAgICAgICAgICB2YXIgdmVydCA9IGkgKiBoZWlnaHQgLSBvZmZzZXQ7XG4gICAgICAgICAgICAgICAgcmV0dXJuICd0cmFuc2xhdGUoJyArIGhvcnogKyAnLCcgKyB2ZXJ0ICsgJyknO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgbGVnZW5kLmFwcGVuZCgncmVjdCcpXG4gICAgICAgICAgICAuYXR0cignd2lkdGgnLCBsZWdlbmRSZWN0U2l6ZSlcbiAgICAgICAgICAgIC5hdHRyKCdoZWlnaHQnLCBsZWdlbmRSZWN0U2l6ZSlcbiAgICAgICAgICAgIC5zdHlsZSgnZmlsbCcsIGZ1bmN0aW9uKGQsIGkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29sb3IoaSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnN0eWxlKCdzdHJva2UnLCBmdW5jdGlvbihkLCBpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbG9yKGkpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgbGVnZW5kLmFwcGVuZCgndGV4dCcpXG4gICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnbGVnZW5kJylcbiAgICAgICAgICAgIC5hdHRyKCd4JywgbGVnZW5kUmVjdFNpemUgKyBsZWdlbmRTcGFjaW5nKVxuICAgICAgICAgICAgLmF0dHIoJ3knLCBsZWdlbmRSZWN0U2l6ZSAtIGxlZ2VuZFNwYWNpbmcpXG4gICAgICAgICAgICAudGV4dChmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQubGFiZWw7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBsZWdlbmREYXRhLmV4aXQoKS5yZW1vdmUoKTtcbiAgICB9XG59KCkpXG4iLCJ2YXIgVHJlZW1hcCA9IChmdW5jdGlvbigpIHtcbiAgICB2YXIgdyA9IDk3MCxcbiAgICAgICAgaCA9IDUwMCxcbiAgICAgICAgeCA9IGQzLnNjYWxlLmxpbmVhcigpLnJhbmdlKFswLCB3XSksXG4gICAgICAgIHkgPSBkMy5zY2FsZS5saW5lYXIoKS5yYW5nZShbMCwgaF0pLFxuICAgICAgICBjb2xvciA9IGQzLnNjYWxlLmNhdGVnb3J5MjBjKCksXG4gICAgICAgIHJvb3QgPSBbXSxcbiAgICAgICAgbm9kZSA9IFtdLFxuICAgICAgICBjaGFydCxcbiAgICAgICAgdHJlZW1hcCxcbiAgICAgICAgc3ZnO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgc2V0dGluZ3M6IHtcbiAgICAgICAgICAgIHRpdGxlOiBcInRyZWVtYXBUaXRsZVwiLFxuICAgICAgICAgICAgZGVzYzogXCJ0cmVlbWFwRGVzY1wiLFxuICAgICAgICAgICAgdHJlZW1hcElkOiBcIiN0cmVlbWFwSWRcIlxuICAgICAgICB9LFxuXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIHRyZWVtYXBJZCA9IHRoaXMuc2V0dGluZ3MudHJlZW1hcElkO1xuXG4gICAgICAgICAgICBkMy5zZWxlY3QoXCIjdHJlZW1hcFRpdGxlXCIpLnRleHQodGhpcy5zZXR0aW5ncy50aXRsZSk7XG4gICAgICAgICAgICBkMy5zZWxlY3QoXCIjdHJlZW1hcERlc2NcIikudGV4dCh0aGlzLnNldHRpbmdzLmRlc2MpO1xuXG4gICAgICAgICAgICBjaGFydCA9IGQzLnNlbGVjdCh0cmVlbWFwSWQpLmFwcGVuZChcImRpdlwiKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJjaGFydFwiKVxuICAgICAgICAgICAgICAgIC5zdHlsZShcIndpZHRoXCIsIHcgKyBcInB4XCIpXG4gICAgICAgICAgICAgICAgLnN0eWxlKFwiaGVpZ2h0XCIsIGggKyBcInB4XCIpXG5cbiAgICAgICAgICAgIHN2ZyA9IGNoYXJ0XG4gICAgICAgICAgICAgICAgLmFwcGVuZChcInN2Z1wiKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgdylcbiAgICAgICAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCBoKVxuICAgICAgICAgICAgICAgIC5hcHBlbmQoXCJnXCIpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoLjUsLjUpXCIpO1xuXG4gICAgICAgICAgICB0cmVlbWFwID0gZDMubGF5b3V0LnRyZWVtYXAoKVxuICAgICAgICAgICAgICAgIC8vIC5yb3VuZChmYWxzZSlcbiAgICAgICAgICAgICAgICAuc2l6ZShbdywgaF0pXG4gICAgICAgICAgICAgICAgLy8gLnN0aWNreShmYWxzZSlcbiAgICAgICAgICAgICAgICAudmFsdWUoZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC53YXRjaGVyc19jb3VudDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBzaG93OiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICBzaG93Q2hhcnQoZGF0YSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzaG93Q2hhcnQoZGF0YSkge1xuICAgICAgICBub2RlID0gcm9vdCA9IFV0aWxzLmdldFRyZWVEYXRhKGRhdGEpO1xuXG4gICAgICAgIHZhciBub2RlcyA9IHRyZWVtYXAubm9kZXMocm9vdClcbiAgICAgICAgICAgIC5maWx0ZXIoZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAhZC5jaGlsZHJlbjtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHZhciBjZWxsID0gc3ZnLnNlbGVjdEFsbChcImdcIilcbiAgICAgICAgICAgIC5kYXRhKG5vZGVzLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQud2F0Y2hlcnNfY291bnQ7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmVudGVyKClcbiAgICAgICAgICAgIC5hcHBlbmQoXCJnXCIpXG4gICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiY2VsbFwiKVxuICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBcInRyYW5zbGF0ZShcIiArIGQueCArIFwiLFwiICsgZC55ICsgXCIpXCI7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB6b29tKG5vZGUgPT0gZC5wYXJlbnQgPyByb290IDogZC5wYXJlbnQpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgY2VsbC5hcHBlbmQoXCJyZWN0XCIpXG4gICAgICAgICAgICAuYXR0cihcIndpZHRoXCIsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5keCAtIDE7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkLmR5IC0gMTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuc3R5bGUoXCJmaWxsXCIsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29sb3IoZC5wYXJlbnQubmFtZSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBjZWxsLmFwcGVuZChcInRleHRcIilcbiAgICAgICAgICAgIC5hdHRyKFwieFwiLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDIgKiBkLmR4IC8gMyArIDIwO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5hdHRyKFwieVwiLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQuZHkgLyAyO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5hdHRyKFwiZHlcIiwgXCIuMzVlbVwiKVxuICAgICAgICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgICAgICAgICAgLnRleHQoZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkLm5hbWU7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgZC53ID0gdGhpcy5nZXRDb21wdXRlZFRleHRMZW5ndGgoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgICAgICAvLyByZXR1cm4gZC5keCA+IGQudyA/IDEgOiAwO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgc3ZnLnNlbGVjdEFsbChcImdcIilcbiAgICAgICAgICAgIC5kYXRhKG5vZGVzKVxuICAgICAgICAgICAgLmV4aXQoKVxuICAgICAgICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgLnN0eWxlKHtcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiAwXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnJlbW92ZSgpO1xuXG4gICAgICAgIGQzLnNlbGVjdCh3aW5kb3cpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB6b29tKHJvb3QpO1xuICAgICAgICB9KTtcblxuICAgICAgICBkMy5zZWxlY3QoXCIjdHJlZW1hcFNlbGVjdFwiKS5vbihcImNoYW5nZVwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRyZWVtYXAudmFsdWUodGhpcy52YWx1ZSA9PSBcIndhdGNoZXJzXCIgPyB3YXRjaGVyc0NvdW50IDogZm9ya3NDb3VudCkubm9kZXMocm9vdCk7XG4gICAgICAgICAgICB6b29tKG5vZGUpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB3YXRjaGVyc0NvdW50KGQpIHtcbiAgICAgICAgcmV0dXJuIGQud2F0Y2hlcnNfY291bnQ7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZm9ya3NDb3VudChkKSB7XG4gICAgICAgIHJldHVybiBkLmZvcmtzX2NvdW50O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHpvb20oZCkge1xuICAgICAgICB2YXIga3ggPSB3IC8gZC5keCxcbiAgICAgICAgICAgIGt5ID0gaCAvIGQuZHk7XG4gICAgICAgIHguZG9tYWluKFtkLngsIGQueCArIGQuZHhdKTtcbiAgICAgICAgeS5kb21haW4oW2QueSwgZC55ICsgZC5keV0pO1xuXG4gICAgICAgIHZhciB0ID0gc3ZnLnNlbGVjdEFsbChcImcuY2VsbFwiKS50cmFuc2l0aW9uKClcbiAgICAgICAgICAgIC5kdXJhdGlvbihkMy5ldmVudC5hbHRLZXkgPyA3NTAwIDogNzUwKVxuICAgICAgICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBcInRyYW5zbGF0ZShcIiArIHgoZC54KSArIFwiLFwiICsgeShkLnkpICsgXCIpXCI7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB0LnNlbGVjdChcInJlY3RcIilcbiAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBreCAqIGQuZHggLSAxO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ga3kgKiBkLmR5IC0gMTtcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgdC5zZWxlY3QoXCJ0ZXh0XCIpXG4gICAgICAgICAgICAuYXR0cihcInhcIiwgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAyICoga3ggKiBkLmR4IC8gMyArIDIwO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5hdHRyKFwieVwiLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGt5ICogZC5keSAvIDI7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgICAgICAgICAgLy8gcmV0dXJuIGt4ICogZC5keCA+IGQudyA/IDEgOiAwO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgbm9kZSA9IGQ7XG4gICAgICAgIGQzLmV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIH1cblxufSgpKVxuIiwiKGZ1bmN0aW9uKCkge1xuICAgIHZhciBsb2FkaW5nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtb2RhbFwiKTtcblxuICAgIC8qKlxuICAgICAqIFNlYXJjaFxuICAgICAqL1xuICAgIFNlYXJjaGVyLmluaXQoKTtcblxuICAgIC8qKlxuICAgICAqIHN0YXJ0IEJhckNoYXJ0XG4gICAgICovXG4gICAgQmFyLnNldHRpbmdzID0ge1xuICAgICAgICB0aXRsZTogXCJUb3AxMDAgQmFyQ2hhcnRcIixcbiAgICAgICAgZGVzYzogXCJUaGlzIGlzIGEgZ29vZCBleGFtcGxlLlwiLFxuICAgICAgICBiYXJJZDogXCIjYmFySWRcIlxuICAgIH1cbiAgICBCYXIuaW5pdCgpO1xuXG4gICAgLyoqXG4gICAgICogc3RhcnQgdHJlZW1hcFxuICAgICAqL1xuICAgIFRyZWVtYXAuc2V0dGluZ3MgPSB7XG4gICAgICAgIHRpdGxlOiBcIlRvcDEwMCB0cmVlbWFwXCIsXG4gICAgICAgIGRlc2M6IFwiWW91IGNhbiBjbGljayB0aGUgYmxvY2sgdG8gem9vbSBpdC5cIixcbiAgICAgICAgdHJlZW1hcElkOiBcIiNzYWNkbFRyZWVtYXBcIlxuICAgIH1cbiAgICBUcmVlbWFwLmluaXQoKTtcblxuICAgIGZ1bmN0aW9uIHNob3codXJsKSB7XG4gICAgICAgIHZhciBsb2FkZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbG9hZGluZy5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgICB9LCAzMDApO1xuXG4gICAgICAgIHVybCA9IHVybCB8fCAnaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS9zZWFyY2gvcmVwb3NpdG9yaWVzP3E9Yml0Y29pbiZzb3J0PWZvcmtzJm9yZGVyPWRlc2MmcGVyX3BhZ2U9MTAwJztcblxuICAgICAgICBkMy5qc29uKHVybCwgZnVuY3Rpb24oZXJyLCBkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGxvYWRlcik7XG4gICAgICAgICAgICAgICAgbG9hZGluZy5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICAgICAgICAgYWxlcnQoXCLliqDovb3mlbDmja7lpLHotKXvvIzor7fmo4Dmn6XmgqjnmoTnvZHnu5zorr7nva7jgIJcIilcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIFV0aWxzLmdldERhdGEoZGF0YSk7XG5cbiAgICAgICAgICAgIEJhci5zaG93KCk7XG4gICAgICAgICAgICBUcmVlbWFwLnNob3coKTtcblxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGxvYWRlcik7XG4gICAgICAgICAgICBsb2FkaW5nLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgU2VhcmNoZXIuYWRkTGlzdGVuZXIoZnVuY3Rpb24odXJsKSB7XG4gICAgICAgIHNob3codXJsKTtcbiAgICB9KVxuXG4gICAgc2hvdygpO1xufSkoKVxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
